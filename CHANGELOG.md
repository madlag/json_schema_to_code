# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.0.0] - 2024-12-19

### Added

#### Generation Comment Feature
- **New config option**: `add_generation_comment: bool = True` - Controls whether to add a generation command comment at the top of generated files
- **Automatic command line tracking**: Generated files now include a comment showing the simplified command used to create them
- **Smart path simplification**: Long file paths are reduced to just filenames for cleaner comments
- **Example**: `# Generated by json_schema_to_code v1.0.0 : json_schema_to_code schema.json output.py -c config.json -l python`

#### Union Type Support
- **anyOf support**: JSON Schema `anyOf` patterns are now converted to Python union types (e.g., `int | str`)
- **oneOf support**: JSON Schema `oneOf` patterns are now converted to Python union types
- **Configurable union style**: New `use_inline_unions: bool = False` config option
  - `True`: Generate inline unions like `int | str`
  - `False`: Generate type aliases like `IntOrStr = int | str`
- **Dynamic type alias generation**: Type aliases are automatically collected and added to file prefix
- **Consistent sorting**: Union types are sorted alphabetically for consistent output

#### Comment Field Filtering
- **Schema comment support**: Fields starting with `_comment` are now filtered out during code generation
- **String field filtering**: String values in schema definitions are automatically ignored
- **Cleaner generated code**: Removes documentation/comment artifacts from schemas

#### Class-level Union Handling
- **Inheritance patterns**: `anyOf` and `oneOf` at class definition level now properly handled
- **Non-object type support**: Classes with non-object types are converted to appropriate union types

### Enhanced

#### Template System
- **Dynamic type aliases**: Python prefix template now dynamically includes generated type aliases
- **Conditional generation comment**: Template conditionally includes generation comment based on config

#### Error Handling
- **Robust type checking**: Added proper checks for missing `type` fields in schema properties
- **Better schema validation**: Improved handling of malformed or incomplete schema definitions

#### Test Coverage
- **Comprehensive test suite**: Added 15+ new test cases covering all new features
- **JSON-driven tests**: Test cases defined in JSON files for easier maintenance and extension
- **Self-contained tests**: Reorganized test directory structure to be independent of personal file paths
- **Multiple test categories**:
  - Union type generation (inline vs type aliases)
  - Comment field filtering
  - Generation comment functionality
  - Real-world schema handling (UI hierarchy)

### Fixed

#### Code Generation
- **Output path construction**: Fixed double-appending of filenames in output paths
- **Type alias scope**: Type aliases are now properly scoped and collected before template rendering
- **Schema preprocessing**: Improved handling of non-dictionary schema elements

#### Module Execution
- **Import resolution**: Fixed relative import issues by using proper module execution (`python -m`)
- **Path handling**: Improved handling of absolute vs relative paths in various contexts

### Changed

#### Test Organization
- **Directory restructure**: Moved `tests/schemas/` to `tests/test_data/schemas/` for better organization
- **Reference file updates**: Updated test reference files to match new consistent sorting behavior
- **Removed personal paths**: Eliminated references to user-specific file paths in test suite

#### Code Architecture
- **Refactored union handling**: Consolidated union type generation logic into single `union_type` method
- **Removed redundancy**: Eliminated `_handle_union_types` wrapper method
- **Enhanced configuration**: Extended `CodeGeneratorConfig` with new options and better defaults

### Technical Details

#### New Configuration Options
```python
class CodeGeneratorConfig:
    use_inline_unions: bool = False          # Control union type style
    add_generation_comment: bool = True      # Add generation command comment
```

#### Supported Union Patterns
- `{"anyOf": [{"type": "string"}, {"type": "number"}]}` → `str | float` or `StrOrFloat`
- `{"oneOf": [{"type": "integer"}, {"type": "string"}]}` → `int | str` or `IntOrStr`
- Class-level unions for inheritance patterns

#### Generated Comment Format
```python
# Generated by json_schema_to_code v1.0.0 : simplified_command with_simplified_paths
```

### Compatibility

- **Backward compatible**: All existing functionality preserved
- **Default behavior**: Generation comments enabled by default, can be disabled
- **Existing schemas**: All previously supported schemas continue to work
- **Template compatibility**: Changes to templates are additive only

## Version History

This release represents a major enhancement to the json_schema_to_code package, introducing robust union type support, generation tracking, and comprehensive test coverage. The version 1.0.0 reflects the maturity and stability of these core features.

[1.0.0]: https://github.com/yourusername/json_schema_to_code/releases/tag/v1.0.0
