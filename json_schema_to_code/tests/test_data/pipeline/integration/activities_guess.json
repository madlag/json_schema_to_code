{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "/activities/guess/guess_schema",
  "title": "Guess Activity Schema",
  "type": "object",
  "$defs": {
    "GuessItemState": {
      "type": "string",
      "enum": [
        "N",
        "H",
        "C",
        "I",
        "F",
        "U",
        "A"
      ],
      "x-enum-members": {
        "N": "NORMAL",
        "H": "HIDDEN",
        "C": "CORRECT",
        "I": "INCORRECT",
        "F": "FILTERED",
        "U": "FILTERED_BY_USER",
        "A": "FILTERED_BY_AGENT"
      },
      "description": "State of an item in guess activity (N=Normal, H=Hidden, C=Correct, I=Incorrect, F=Filtered generic, U=Filtered by user, A=Filtered by agent/hint)"
    },
    "GuessHint": {
      "x-csharp-generate": false,
      "type": "object",
      "description": "A hint for the guess activity",
      "properties": {
        "hint_id": {
          "type": "string",
          "description": "Unique identifier for this hint"
        },
        "hint_text": {
          "type": "string",
          "description": "The hint text to display"
        },
        "difficulty": {
          "type": "integer",
          "description": "Difficulty level (higher = more difficult/less helpful)",
          "minimum": 0
        }
      },
      "required": [
        "hint_id",
        "hint_text",
        "difficulty"
      ],
      "additionalProperties": false
    },
    "GuessProblem": {
      "x-csharp-generate": false,
      "type": "object",
      "description": "Generic guess problem - contains the correct answer, question, and hints",
      "properties": {
        "correct_item_id": {
          "type": "integer",
          "description": "The index of the correct item (0-based, used to index into item_states)",
          "minimum": 0
        },
        "question_text": {
          "type": "string",
          "description": "The question or prompt to display to the student",
          "default": ""
        },
        "difficulty_level": {
          "type": "integer",
          "description": "Difficulty level (higher = more difficult)",
          "minimum": 1,
          "default": 1
        },
        "correct_answer_text": {
          "type": "string",
          "description": "Human-readable text of the correct answer (for display after completion)",
          "default": ""
        },
        "hints": {
          "type": "array",
          "description": "Available hints for this problem",
          "items": {
            "$ref": "#/$defs/GuessHint"
          },
          "default": []
        }
      },
      "required": [
        "correct_item_id",
        "question_text",
        "difficulty_level",
        "correct_answer_text",
        "hints"
      ],
      "additionalProperties": false
    },
    "GuessState": {
      "x-csharp-generate": false,
      "type": "object",
      "description": "State tracking for guess activity",
      "properties": {
        "selected_item_ids": {
          "type": "array",
          "description": "List of selected item identifiers (history of guesses)",
          "items": {
            "type": "integer"
          },
          "default": []
        },
        "item_states": {
          "type": "string",
          "pattern": "^[NHCIFUA]*$",
          "description": "State of each item (indexed by position). Each character represents one item's state.",
          "default": ""
        },
        "used_hints": {
          "type": "array",
          "description": "List of hint IDs that have been revealed",
          "items": {
            "type": "string"
          },
          "default": []
        }
      },
      "required": [
        "selected_item_ids",
        "item_states",
        "used_hints"
      ],
      "additionalProperties": false
    },
    "GuessUIData": {
      "type": "object",
      "description": "UI data for guess activity rendering",
      "properties": {
        "question_text": {
          "type": "string",
          "description": "The question text to display",
          "default": ""
        },
        "used_hints": {
          "type": "array",
          "description": "List of hints that have been revealed",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "item_states": {
          "type": "string",
          "pattern": "^[NHCIFUA]*$",
          "description": "State of each item (indexed by position)",
          "default": ""
        },
        "actionTemplate": {
          "$ref": "#/$defs/UIAction",
          "description": "Template action for selecting an item",
          "default": null
        }
      },
      "required": [
        "question_text",
        "used_hints",
        "item_states",
        "actionTemplate"
      ],
      "additionalProperties": false
    },
    "GuessData": {
      "x-csharp-generate": false,
      "type": "object",
      "description": "Complete activity data for guess - problem, student's guesses, and state",
      "properties": {
        "problem": {
          "$ref": "#/$defs/GuessProblem",
          "description": "The guess problem"
        },
        "state": {
          "$ref": "#/$defs/GuessState",
          "default": null,
          "description": "Current student guess state"
        },
        "ui_data": {
          "$ref": "#/$defs/GuessUIData",
          "default": null,
          "description": "UI rendering data"
        }
      },
      "required": [
        "problem",
        "state",
        "ui_data"
      ],
      "additionalProperties": false
    },
    "UIAction": {
      "type": "object",
      "description": "Action configuration for user input components",
      "properties": {
        "operations": {
          "type": "array",
          "description": "Action parameters (always an array, even for a single parameter)",
          "items": {
            "$ref": "#/$defs/UIStateChangeOperation"
          },
          "minItems": 1
        }
      },
      "required": [
        "operations"
      ]
    },
    "UIStateChangeOperation": {
      "type": "object",
      "description": "Action parameter as a JSON object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of the action parameter",
          "const": "state_change"
        },
        "path": {
          "type": "string",
          "description": "Path to the action parameter"
        },
        "op": {
          "type": "string",
          "description": "Operation to perform on the action parameter",
          "enum": [
            "add",
            "remove",
            "replace",
            "type_change",
            "append"
          ]
        },
        "value_type": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Accepted types for the value (any match is valid)",
            "enum": [
              "dict",
              "array",
              "string",
              "char",
              "boolean",
              "integer",
              "float",
              "null",
              "any"
            ]
          },
          "minItems": 1,
          "description": "List of acceptable types for the value (e.g., [\"integer\", \"number\"] allows either)"
        },
        "value": {
          "description": "Value to set for the action parameter (filled by controller before sending, optional in JSON). Can be any type: string, number, boolean, null, object, or array.",
          "type": "object"
        }
      },
      "required": [
        "path",
        "op",
        "value_type"
      ]
    }
  },
  "$ref": "#/$defs/GuessData"
}
